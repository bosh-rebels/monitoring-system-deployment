---
platform: linux

image_resource:
  type: docker-image
  source:
    repository: paymentshubrebels/bosh-utils
    tag: 'latest'

params:
  deployment_name:
  errands_to_be_run:
  BOSH_ENVIRONMENT:
  BOSH_CA_CERT:
  BOSH_CLIENT:
  BOSH_CLIENT_SECRET:
run:
  path: /bin/bash
  args:
  - -ec
  - |
    errands_names="${errands_to_be_run}"
    for errand in ${errands_names}; do
      bosh -d "${deployment_name}" run-errand "${errand}"
    done